# 60-findings â€“ Client Findings

This directory contains structured findings for tested email clients, based on the NDSS 2025 reproduction.

Current clients:
- Thunderbird 140.4.0esr on Kali GNU/Linux Rolling (x86_64)

See individual markdown files in this folder for detailed results per client and test case.

In addition to client testing, this folder also contains a **passive Shodan measurement** (banner-based indicators on mail STARTTLS ports):
- Plots + explanation: `60-findings/shodan-plots/`
- Reproduction scripts: `60-findings/shodan-plots/shodan_mail_tls_stats.py` and `60-findings/shodan-plots/plot_shodan_mail_tls_stats.py`

## ğŸ“Š Client Vulnerability Matrix

Legend:
- âœ… **Secure:** Client detects attack and aborts connection (no plaintext credentials sent).
- âŒ **Vulnerable:** Client falls back to plaintext authentication (credentials exposed).
- âš ï¸ **User-Dependent:** Client shows error/warning, but suggests insecure action (e.g. "Disable STARTTLS").
- âšª **Untested:** Not yet tested.

### STARTTLS Stripping (T1), ServerHello Replacement (T2), Command Rejection (T3), Session Disruption (T4)

| | | | Manual Configuration | | | | Auto-detect | | | |
| :--- | :--- | :--- | :---: | :---: | :---: | :---: | :---: | :---: | :---: | :---: |
| **Client** | **OS / Platform** | **Protocol** | **T1** | **T2** | **T3** | **T4** | **T1** | **T2** | **T3** | **T4** |
| **Thunderbird 140.4.0esr** | Kali Linux | **IMAP** | âœ… | âœ… | âœ… | âš ï¸ | âšª | âšª | âšª | âšª |
| | | **SMTP** | âš ï¸ | âœ… | âœ… | âœ… | âšª | âšª | âšª | âšª |
| | | **POP3** | âœ… | âœ… | âœ… | âœ… | âšª | âšª | âšª | âšª |
| | | | | | | | | | | |

---

## ğŸ“ Notes

- **Thunderbird (SMTP T1):** Client fails securely (no plaintext auth) but explicitly suggests disabling STARTTLS in the error message. This is marked as âš ï¸ **User-Dependent** risk.
- **Thunderbird (IMAP T4):** Client detects untrusted certificate and shows warning dialog. User must actively click "Confirm Security Exception" to proceed. No credentials sent without user action. Marked as âš ï¸ **User-Dependent**.

## ğŸ”§ Test Setup

### Complete Infrastructure Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    COMPLETE TEST INFRASTRUCTURE                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     LOCAL MACHINE (Kali Linux)                â”‚     â”‚     AWS EC2 (Ubuntu)      â”‚
â”‚                                                               â”‚     â”‚                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                         â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Email Client   â”‚                                         â”‚     â”‚  â”‚    MAIL SERVER      â”‚  â”‚
â”‚  â”‚   (Thunderbird)  â”‚                                         â”‚     â”‚  â”‚  mail.nsipmail.de   â”‚  â”‚
â”‚  â”‚                  â”‚                                         â”‚     â”‚  â”‚    13.62.95.49      â”‚  â”‚
â”‚  â”‚  Proxy: No proxy â”‚                                         â”‚     â”‚  â”‚                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                         â”‚     â”‚  â”‚  Postfix (SMTP)     â”‚  â”‚
â”‚           â”‚                                                   â”‚     â”‚  â”‚  Dovecot (IMAP/POP3)â”‚  â”‚
â”‚           â”‚ Outgoing traffic to mail server                   â”‚     â”‚  â”‚                     â”‚  â”‚
â”‚           â–¼                                                   â”‚     â”‚  â”‚  Let's Encrypt Cert â”‚  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”‚                 KERNEL (iptables)                      â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚                 NAT OUTPUT Chain                       â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚                                                        â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”‚Port 143 â”‚ â”‚Port 993 â”‚ â”‚Port 587 â”‚ â”‚Port 465 â”‚      â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”‚ (IMAP)  â”‚ â”‚ (IMAPS) â”‚ â”‚ (SMTP)  â”‚ â”‚ (SMTPS) â”‚      â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜      â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚        â”‚           â”‚           â”‚           â”‚           â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                              â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”‚Port 110 â”‚ â”‚Port 995 â”‚    ALL REDIRECT TO :8080     â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â”‚ (POP3)  â”‚ â”‚ (POP3S) â”‚                              â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜                              â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚        â”‚           â”‚           â”‚           â”‚           â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚                        â”‚                               â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚             â”‚             â”‚
â”‚                           â–¼                                   â”‚     â”‚             â”‚             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚                    mitmproxy                           â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚              --mode transparent                        â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚              --listen-port 8080                        â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚                                                        â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   Loaded Script: imap/t1.py, smtp/t2.py, pop3/t3.py... â”‚â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤             â”‚
â”‚  â”‚                                                        â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â”‚   Intercepts & manipulates traffic before forwarding   â”‚   â”‚     â”‚             â”‚             â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚     â”‚             â–¼             â”‚
â”‚                                                               â”‚     â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚  â”‚   Accepts traffic   â”‚  â”‚
                                                                      â”‚  â”‚   on all ports      â”‚  â”‚
                                                                      â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
                                                                      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Mail Server Port Configuration (mail.nsipmail.de)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                              MAIL SERVER: mail.nsipmail.de (13.62.95.49)                        â”‚
â”‚                                        AWS EC2 Â· Ubuntu 22.04                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                                                 â”‚
â”‚   IMAP (Dovecot)                    SMTP (Postfix)                   POP3 (Dovecot)             â”‚
â”‚   â•â•â•â•â•â•â•â•â•â•â•â•â•â•                    â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•                  â•â•â•â•â•â•â•â•â•â•â•â•â•              â”‚
â”‚                                                                                                 â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚   â”‚  Port 993   â”‚ â”‚  Port 143   â”‚   â”‚  Port 465   â”‚ â”‚  Port 587   â”‚  â”‚  Port 995   â”‚ â”‚Port 110â”‚ â”‚
â”‚   â”‚   IMAPS     â”‚ â”‚    IMAP     â”‚   â”‚   SMTPS     â”‚ â”‚ Submission  â”‚  â”‚   POP3S     â”‚ â”‚  POP3  â”‚ â”‚
â”‚   â”‚             â”‚ â”‚             â”‚   â”‚             â”‚ â”‚             â”‚  â”‚             â”‚ â”‚        â”‚ â”‚
â”‚   â”‚ Implicit TLSâ”‚ â”‚  STARTTLS   â”‚   â”‚ Implicit TLSâ”‚ â”‚  STARTTLS   â”‚  â”‚ Implicit TLSâ”‚ â”‚STARTTLSâ”‚ â”‚
â”‚   â”‚  (secure)   â”‚ â”‚ (vulnerable)â”‚   â”‚  (secure)   â”‚ â”‚ (vulnerable)â”‚  â”‚  (secure)   â”‚ â”‚(vulner)â”‚ â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”¬â”€â”€â”€â”€â”˜ â”‚
â”‚          â”‚               â”‚                 â”‚               â”‚                â”‚            â”‚      â”‚
â”‚          â–¼               â–¼                 â–¼               â–¼                â–¼            â–¼      â”‚
â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚   â”‚                                  VULNERABILITY SETTINGS                                 â”‚   â”‚
â”‚   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤   â”‚
â”‚   â”‚                                                                                         â”‚   â”‚
â”‚   â”‚   Dovecot (IMAP/POP3):                    Postfix (SMTP):                               â”‚   â”‚
â”‚   â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                    â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                               â”‚   â”‚
â”‚   â”‚   disable_plaintext_auth = no             smtpd_tls_auth_only = no                      â”‚   â”‚
â”‚   â”‚   ssl = yes (not required)                smtpd_tls_security_level = may                â”‚   â”‚
â”‚   â”‚                                                                                         â”‚   â”‚
â”‚   â”‚   â†’ Server accepts LOGIN/AUTH commands even WITHOUT active TLS encryption!              â”‚   â”‚
â”‚   â”‚   â†’ This allows credentials to be sent in plaintext if STARTTLS is stripped.            â”‚   â”‚
â”‚   â”‚                                                                                         â”‚   â”‚
â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                                                 â”‚
â”‚   DNS Configuration:                                                                            â”‚
â”‚   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                                            â”‚
â”‚   A     mail.nsipmail.de  â†’  13.62.95.49                                                        â”‚
â”‚   MX    nsipmail.de       â†’  mail.nsipmail.de                                                   â”‚
â”‚   TXT   nsipmail.de       â†’  v=spf1 mx ~all                                                     â”‚
â”‚                                                                                                 â”‚
â”‚   Note: Autodiscover DISABLED to force clients into "Heuristic Guessing" mode                   â”‚
â”‚                                                                                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Traffic Redirection (iptables) â€“ All Protocols

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                  iptables TRAFFIC REDIRECTION                                   â”‚
â”‚                                      (LOCAL MACHINE)                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚         KERNEL (iptables)       â”‚
                              â”‚         NAT OUTPUT Chain        â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚             â”‚             â”‚                   â”‚             â”‚             â”‚
        â–¼             â–¼             â–¼                   â–¼             â–¼             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Port 143    â”‚â”‚ Port 993    â”‚â”‚ Port 587    â”‚   â”‚ Port 465    â”‚â”‚ Port 110    â”‚â”‚ Port 995    â”‚
â”‚ IMAP        â”‚â”‚ IMAPS       â”‚â”‚ SMTP        â”‚   â”‚ SMTPS       â”‚â”‚ POP3        â”‚â”‚ POP3S       â”‚
â”‚ (STARTTLS)  â”‚â”‚ (Implicit)  â”‚â”‚ (STARTTLS)  â”‚   â”‚ (Implicit)  â”‚â”‚ (STARTTLS)  â”‚â”‚ (Implicit)  â”‚
â”‚      â”‚      â”‚â”‚      â”‚      â”‚â”‚      â”‚      â”‚   â”‚      â”‚      â”‚â”‚      â”‚      â”‚â”‚      â”‚      â”‚
â”‚      â–¼      â”‚â”‚      â–¼      â”‚â”‚      â–¼      â”‚   â”‚      â–¼      â”‚â”‚      â–¼      â”‚â”‚      â–¼      â”‚
â”‚ REDIRECT    â”‚â”‚ REDIRECT    â”‚â”‚ REDIRECT    â”‚   â”‚ REDIRECT    â”‚â”‚ REDIRECT    â”‚â”‚ REDIRECT    â”‚
â”‚  :8080      â”‚â”‚  :8080      â”‚â”‚  :8080      â”‚   â”‚  :8080      â”‚â”‚  :8080      â”‚â”‚  :8080      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚             â”‚             â”‚                   â”‚             â”‚             â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                              â”‚
                                              â–¼
                              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                              â”‚           mitmproxy             â”‚
                              â”‚       --listen-port 8080        â”‚
                              â”‚       --mode transparent        â”‚
                              â”‚                                 â”‚
                              â”‚   Runs T1-T4 attack scripts:    â”‚
                              â”‚   â€¢ imap/t1.py, t2.py, t3.py... â”‚
                              â”‚   â€¢ smtp/t1.py, t2.py, t3.py... â”‚
                              â”‚   â€¢ pop3/t1.py, t2.py, t3.py... â”‚
                              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Commands:**
```bash
# IMAP
sudo iptables -t nat -A OUTPUT -p tcp --dport 143 -j REDIRECT --to-port 8080
sudo iptables -t nat -A OUTPUT -p tcp --dport 993 -j REDIRECT --to-port 8080

# SMTP
sudo iptables -t nat -A OUTPUT -p tcp --dport 587 -j REDIRECT --to-port 8080
sudo iptables -t nat -A OUTPUT -p tcp --dport 465 -j REDIRECT --to-port 8080

# POP3
sudo iptables -t nat -A OUTPUT -p tcp --dport 110 -j REDIRECT --to-port 8080
sudo iptables -t nat -A OUTPUT -p tcp --dport 995 -j REDIRECT --to-port 8080

# Cleanup after testing
sudo iptables -t nat -F
```

### Attack Scripts â€“ What They Do Per Protocol

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                    ATTACK SCRIPTS (T1-T4)                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           IMAP                   â”‚           SMTP                   â”‚           POP3             â”‚
â”‚     (imap/t1.py - t4.py)         â”‚     (smtp/t1.py - t4.py)         â”‚    (pop3/t1.py - t4.py)    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ Port 993 (IMAPS):                â”‚ Port 465 (SMTPS):                â”‚ Port 995 (POP3S):          â”‚
â”‚ â†’ Block (empty response)         â”‚ â†’ Block (empty response)         â”‚ â†’ Block (empty response)   â”‚
â”‚   Forces fallback to 143         â”‚   Forces fallback to 587         â”‚   Forces fallback to 110   â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ Port 143 (IMAP):                 â”‚ Port 587 (Submission):           â”‚ Port 110 (POP3):           â”‚
â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€           â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ T1: Strip STARTTLS from          â”‚ T1: Strip STARTTLS from          â”‚ T1: Strip STLS from        â”‚
â”‚     CAPABILITY response          â”‚     EHLO response                â”‚     CAPA response          â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ T2: Replace TLS ServerHello      â”‚ T2: Replace TLS ServerHello      â”‚ T2: Replace TLS ServerHelloâ”‚
â”‚     with error after ClientHello â”‚     with error after ClientHello â”‚     with error             â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ T3: Reject STARTTLS command      â”‚ T3: Reject STARTTLS command      â”‚ T3: Reject STLS command    â”‚
â”‚     with "BAD" response          â”‚     with error response          â”‚     with "-ERR" response   â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â”‚ T4: Replace TLS Application Data â”‚ T4: Replace TLS Application Data â”‚ T4: Replace TLS App Data   â”‚
â”‚     with plaintext NOOP          â”‚     with plaintext               â”‚     with "-ERR"            â”‚
â”‚                                  â”‚                                  â”‚                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Manual vs. Autodetect Configuration

| Aspect | Manual Configuration | Autodetect |
|--------|---------------------|------------|
| **User sets** | Port + Security explicitly (e.g., 143 + STARTTLS) | Only email address |
| **Client decides** | Nothing â€“ user controls everything | Port, security, authentication |
| **Attack surface** | Only the chosen port | All ports (993 â†’ 143 fallback) |
| **What we test** | Does client fall back to plaintext? | Does client choose insecure option? |

### Attack Flow Diagrams

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                         ATTACK FLOWS                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

AUTODETECT SCENARIO (Example: IMAP):
====================================

   LOCAL MACHINE                                                          MAIL SERVER
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Email Client              mitmproxy (MITM)                             mail.nsipmail.de
        â”‚                          â”‚                                            â”‚
        â”‚â”€â”€â”€â”€ Connect :993 â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                            â”‚
        â”‚                          â”‚â”€â”€â”€â”€ Connect :993 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                          â”‚â—„â”€â”€â”€ TLS ServerHello â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚â—„â”€â”€â”€ [BLOCKED/EMPTY] â”€â”€â”€â”€â”€â”‚  (Script blocks implicit TLS)              â”‚
        â”‚                          â”‚                                            â”‚
        â”‚  (Client: "993 failed, try 143...")                                   â”‚
        â”‚                          â”‚                                            â”‚
        â”‚â”€â”€â”€â”€ Connect :143 â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                            â”‚
        â”‚                          â”‚â”€â”€â”€â”€ Connect :143 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                          â”‚â—„â”€â”€â”€ * OK ... CAPABILITY ... STARTTLS â”€â”€â”€â”€â”€â”€â”‚
        â”‚â—„â”€â”€â”€ * OK ... CAPABILITY â”€â”‚  (T1: STARTTLS stripped from response)     â”‚
        â”‚     [STARTTLS removed]   â”‚                                            â”‚
        â”‚                          â”‚                                            â”‚
        â”‚  (Client: "No STARTTLS available, server doesn't support TLS")        â”‚
        â”‚                          â”‚                                            â”‚
        â”‚â”€â”€â”€â”€ a1 LOGIN user pass â”€â–ºâ”‚                                            â”‚
        â”‚              â–²           â”‚                                            â”‚
        â”‚              â”‚           â”‚                                            â”‚
        â”‚     CREDENTIALS IN       â”‚                                            â”‚
        â”‚     PLAINTEXT!           â”‚                                            â”‚


MANUAL CONFIG SCENARIO (Example: SMTP Port 587):
================================================

   LOCAL MACHINE                                                          MAIL SERVER
   â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€                                                          â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
   Email Client              mitmproxy (MITM)                             mail.nsipmail.de
        â”‚                          â”‚                                            â”‚
        â”‚â”€â”€â”€â”€ Connect :587 â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                            â”‚
        â”‚                          â”‚â”€â”€â”€â”€ Connect :587 â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                          â”‚â—„â”€â”€â”€ 220 mail.nsipmail.de ESMTP â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚â—„â”€â”€â”€ 220 ... ESMTP â”€â”€â”€â”€â”€â”€â”€â”‚                                            â”‚
        â”‚                          â”‚                                            â”‚
        â”‚â”€â”€â”€â”€ EHLO client â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                                            â”‚
        â”‚                          â”‚â”€â”€â”€â”€ EHLO client â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
        â”‚                          â”‚â—„â”€â”€â”€ 250-STARTTLS ... â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
        â”‚â—„â”€â”€â”€ 250-... [stripped] â”€â”€â”‚  (T1: STARTTLS removed from EHLO response) â”‚
        â”‚                          â”‚                                            â”‚
        â”‚                          â”‚                                            â”‚
        â”‚  SECURE CLIENT (Thunderbird):                                         â”‚
        â”‚  "STARTTLS required but not offered â†’ Connection aborted"             â”‚
        â”‚                          â”‚                                            â”‚
        â”‚  INSECURE CLIENT:                                                     â”‚
        â”‚  "OK, continue without TLS"                                           â”‚
        â”‚â”€â”€â”€â”€ AUTH PLAIN base64 â”€â”€â–ºâ”‚  â† CREDENTIALS EXPOSED!                    â”‚
```

### Paper Findings Context

From the NDSS 2025 paper:
- **Manual config:** Only 8/49 clients offer "opportunistic TLS" (try TLS, continue without if it fails)
- **Autodetect:** 14/30 clients silently downgrade without user knowledge

---